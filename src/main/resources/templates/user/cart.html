<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::layout(~{::section})}">

<head>
  <meta charset="ISO-8859-1" />
  <title>Cart Page</title>
</head>

<body>
<section>
  <div class="container-fluid mt-5 p-5">
    <div class="card card-sh">

      <div class="card-header text-center">
        <p class="fs-4">Cart Page</p>

        <th:block th:if="${session.succMsg}">
          <p class="text-success fw-bold">[[${session.succMsg}]]</p>
          <th:block th:text="${@commonServiceImpl.removeSessionMessage()}"></th:block>
        </th:block>

        <th:block th:if="${session.errorMsg}">
          <p class="text-danger fw-bold">[[${session.errorMsg}]]</p>
          <th:block th:text="${@commonServiceImpl.removeSessionMessage()}"></th:block>
        </th:block>
      </div>

      <div class="card-body">
        <table class="table">
          <thead>
          <tr>
            <th scope="col">Sl No</th>
            <th scope="col">Image</th>
            <th scope="col">Product Name</th>
            <th scope="col">Price</th>
            <th scope="col" class="text-center">Quantity</th>
            <th scope="col">Total Price</th>
          </tr>
          </thead>

          <tbody>
          <tr th:each="cart,c:${carts}">
            <th scope="row">[[${c.count}]]</th>

            <td>
              <img th:src="@{'/img/product_img/'+${cart.product.image}}"
                   width="70px" height="70px" />
            </td>

            <td>[[${cart.product.title}]]</td>
            <td>[[${cart.product.discountPrice}]]</td>

            <!-- Quantity Column (POST version) -->
            <td class="text-center">

              <!-- Decrease -->
              <form th:action="@{/user/cartQuantityUpdate}"
                    method="post"
                    style="display:inline;">
                <input type="hidden" name="sy" value="de" />
                <input type="hidden" name="cid" th:value="${cart.id}" />

                <!-- CSRF token (only if available) -->
                <th:block th:if="${_csrf != null}">
                  <input type="hidden"
                         th:name="${_csrf.parameterName}"
                         th:value="${_csrf.token}" />
                </th:block>

                <button type="submit"
                        style="border:none; background:none; padding:0;">
                  <i class="fa-solid fa-minus"></i>
                </button>
              </form>

              [ [[${cart.quantity}]] ]

              <!-- Increase -->
              <form th:action="@{/user/cartQuantityUpdate}"
                    method="post"
                    style="display:inline;">
                <input type="hidden" name="sy" value="in" />
                <input type="hidden" name="cid" th:value="${cart.id}" />

                <!-- CSRF token (only if available) -->
                <th:block th:if="${_csrf != null}">
                  <input type="hidden"
                         th:name="${_csrf.parameterName}"
                         th:value="${_csrf.token}" />
                </th:block>

                <button type="submit"
                        style="border:none; background:none; padding:0;">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </form>

            </td>

            <td>[[${cart.totalPrice}]]</td>
          </tr>

          <tr>
            <td colspan="4"></td>
            <td class="fw-bold">Total Price</td>
            <td class="fw-bold">
              <th:block th:utext="${@commonServiceImpl.rupeeSign()}"></th:block>
              [[${totalOrderPrice}]]
            </td>
          </tr>

          </tbody>
        </table>

        <div class="text-center">
          <a href="/user/orders" class="btn btn-warning">Proceed Payment</a>
        </div>

      </div>
    </div>
  </div>
</section>
</body>
</html>
